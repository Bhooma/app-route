<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-location/iron-location.html">
<link rel="import" href="../iron-location/iron-query-params.html">
<link rel="import" href="carbon-route-converter-behavior.html">

<!--
`carbon-hash-location` is an element that provides synchronization between the
browser location bar and the state of an app. When created,
`carbon-hash-location` elements will automatically watch the global location
for changes. As changes occur, `carbon-hash-location` produces and updates an
object called `route`. This `route` object is suitable for passing into a
`carbon-route`, and other similar elements.

`carbon-hash-location` differs from `carbon-location` by using window.hash
rather window.pathname for the routing path, requiring less server cooperation.

An example of the public API of a route object that describes the URL
`https://elements.polymer-project.org/?foo=bar&baz=qux#/elements/carbon-route-converter`:

    {
      prefix: '',
      path: '/elements/carbon-route-converter'
    }

Example Usage:

    <carbon-hash-location route="{{route}}"></carbon-hash-location>
    <carbon-route route="{{route}}" pattern="/:page" data="{{data}}"></carbon-route>

As you can see above, the `carbon-hash-location` element produces a `route` and that
property is then bound into the `carbon-route` element. The bindings are two-
directional, so when changes to the `route` object occur within `carbon-route`,
they automatically reflect back to the global location.

@element carbon-hash-location
@demo demo/index.html
-->
<dom-module id="carbon-hash-location">
  <template>
    <iron-location
        query="{{__query}}"
        hash="{{path}}"
        url-space-regex={{urlSpaceRegex}}>
    </iron-location>
    <iron-query-params
        params-string="{{__query}}"
        params-object="{{queryParams}}">
    </iron-query-params>
  </template>
  <script>
    'use strict';

    Polymer({
      is: 'carbon-hash-location',

      properties: {
        /**
         * A model representing the deserialized path through the route tree, as
         * well as the current queryParams.
         */
        route: {
          type: Object,
          notify: true
        },

        /**
         * A regexp that defines the set of URLs that should be considered part
         * of this web app.
         *
         * Clicking on a link that matches this regex won't result in a full page
         * navigation, but will instead just update the URL state in place.
         *
         * This regexp is given everything after the origin in an absolute
         * URL. So to match just URLs that start with /search/ do:
         *     url-space-regex="^/search/"
         *
         * @type {string|RegExp}
         */
        urlSpaceRegex: {
          type: String,
          notify: true
        },

        /**
         * A set of key/value pairs that are universally accessible to branches
         * of the route tree.
         */
        __queryParams: {
          type: Object
        },

        /**
         * The hash portion of the current URL.
         */
        __hash: {
          type: String
        },
      },

      behaviors: [Polymer.CarbonRouteConverterBehavior]
    });
  </script>
</dom-module>
