<!DOCTYPE html>
<!--
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at
http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at
http://polymer.github.io/PATENTS.txt
-->
<html>
<head>
<script src="../../webcomponentsjs/webcomponents-lite.js"></script>

<title>carbon-route Demo</title>
<link rel="import" href="../../polymer/polymer.html">

<link rel="import" href="../../paper-styles/paper-styles.html">
<link rel="import" href="../../paper-card/paper-card.html">
<link rel="import" href="../../iron-pages/iron-pages.html">

<link rel="import" href="../carbon-location.html">
<link rel="import" href="../carbon-route.html">

<link rel="import" href="youtube-search.html">
<link rel="import" href="video-viewer.html">
</head>

<body>

<carbon-router-demo></carbon-router-demo>

<dom-module id="carbon-router-demo">
  <template>
    <style>
      paper-button {
        @apply(--paper-font-common-base);
        color: var(--paper-red-500);
        margin-bottom: 16px;
      }

      a {
        color: black;
        text-decoration: none;
      }

      paper-card {
        max-width: 300px;
        margin-bottom: 16px;
      }
    </style>

    <!-- carbon-location binds with the URL and produces a route for
    carbon-route elements to consume. Since this demo is needs to run without
    server cooperation (e.g. with polyserve, in the elements catalog, etc) we'll
    use the hash portion of the URL for our route paths. -->
    <carbon-location route={{route}} use-hash-as-path></carbon-location>

    <!-- carbon-routes parse route paths based on the their `match` pattern.
    Parameters are extracted into the `data` object. The rest of the path that
    comes after the `match` pattern is put into the `tail` object, which can be
    passed to the `route` property of downstream carbon-routes. -->
    <carbon-route route="{{route}}" match="/:page" data="{{data}}"></carbon-route>
    <carbon-route route="{{route}}" match="/search" tail="{{searchTail}}"></carbon-route>
    <carbon-route route="{{route}}" match="/video" tail="{{videoTail}}"></carbon-route>

    <iron-pages attr-for-selected="page" selected="{{data.page}}">
      <div page="search">
        <!-- The input-card has a carbon-route that consumes the tail of another
        route -->
        <youtube-search
            route="{{searchTail}}"
            video-data="{{videoData}}">
        </youtube-search>
        <div>
          <template is="dom-repeat" items="{{videos}}" as="video">
            <!-- The '#' is included because of the use-hash-as-path property is
            set to true in the carbon-location above -->
            <a href="./#/video/{{video.id}}">
              <paper-card image="{{video.thumbnail}}">
                <div class="card-content">
                  {{video.title}}
                </div>
              </paper-card>
            </a>
          </template>
        </div>
      </div>

      <div page="video">
        <!-- The '#' is included because of the use-hash-as-path property is set
        to true in the carbon-location above -->
        <a href="./#/search">
          <paper-button>Back to Search</paper-button>
        </a>

        <!-- The video-viewer has a carbon-route that consumes the tail of
        another route -->
        <video-viewer route="{{videoTail}}"></video-viewer>
      </div>
    </iron-pages>

  </template>

  <script>
    Polymer({
      is: 'carbon-router-demo',

      properties: {
        route: {
          type: Object
        },

        videoData: {
          type: Object,
          observer: '_videoDataChanged'
        },

        searchTail: {
          type: Object,
          notify: true
        },

        videoTail: {
          type: Object,
          notify: true
        },

        newCategory: {
          type: String
        },

        videos: {
          type: Array,
          value: []
        },

        data: {
          type: Object,
          value: {
            page: '/search/'
          }
        }
      },

      ready: function() {
        // If we do not have an initial URL, we redirect tp /search
        this.async(function() {
          if (!this.route.path) {
            this.set('route.path', '/search');
          }
        },1);
      },

      _videoDataChanged: function(data) {
        var allVideos = [];

        var that = this;

        data.items.forEach(function (videoItem) {
          var youtubeVideo = {
            id: videoItem.id.videoId,
            title: videoItem.snippet.title,
            thumbnail: videoItem.snippet.thumbnails.high.url
          };

          allVideos.push(youtubeVideo);
        });

        this.set('videos', allVideos);
      }
    });
  </script>
</dom-module>
</body>
</html>
